\begin{figure}
\centering
\begin{tikzpicture}
\pgfmathsetmacro{\ksepX}{3}
\pgfmathsetmacro{\ksepY}{1.5}
\pgfmathsetmacro{\kpinA}{0.5}
\pgfmathsetmacro{\kpinB}{0.4}
\kuTFFd[u0]{0}{0}
\kuTFFd[u1]{-1*\ksepX}{0}
\kuTFFd[u2]{-2*\ksepX}{0}
\draw(u0p6)--++(0,\kpinA)node[above]{$Q_0$};
\draw(u1p6)--++(0,\kpinA)node[above]{$Q_1$};
\draw(u2p6)--++(0,\kpinA)node[above]{$Q_2$};
\draw(-2.25*\ksepX,-\ksepY)node[and port, number inputs=2,scale=1,rotate=180,anchor=out](u3){};
\draw(u2p1)|-(u3.out);
\draw(u1p1)|-(u3.in 1);
\draw(u1p6)--++(-1.5*\kpinA,0)|-(u3.in 2);
\draw(u0p6)--++(-1.5*\kpinA,0)|-(u1p1 |-u3.in 1);
\draw(u0p1)--++(0,-0.35*\ksepY)coordinate(dd);
\kindown[j1]{dd};
\draw(j1south)node[below]{$1$};
\draw(u2p2)--++(0,-1*\kpinA)--++(2*\ksepX+2*\kpinA,0)coordinate(kclk);
\kinright[j2]{kclk};
\draw(j2east)node[right]{$C$};
\draw(u1p2)|-(kclk);
\draw(u0p2)|-(kclk);
\draw(u2pd)--++(0,-3*\kpin)--++(2*\ksepX,0)coordinate(krst);
\kinright[j3]{krst};
\draw(j3east)node[right]{$\overline{\text{\RL{زبردستی پست}}}$};
\draw(u0pd)|-(krst);
\draw(u1pd)|-(krst);
\end{tikzpicture}
\end{figure}

%=======================
%fig 8.3
\begin{figure}
\centering
\begin{subfigure}{1\textwidth}
\centering
\begin{tikzpicture}
\pgfmathsetmacro{\kxstep}{1}
\pgfmathsetmacro{\kystep}{1}
\pgfmathsetmacro{\kpin}{0.75}
\pgfmathsetmacro{\kmv}{0.15}
\draw[xstep=\kxstep,ystep=\kystep](0,0) grid (4*\kxstep,-2*\kystep);
\draw(0,0)--++(135:1.5*\kpin)node[pos=0.75,above right]{$Q_1Q_0$}node[pos=0.75,below left]{$Q_2$};
\foreach \kx/\xlb in {0/{00},1/{01},2/{11},3/{10}}{\draw(\kx*\kxstep+\kxstep/2,0)node[above]{$\xlb$};}
\foreach \ky/\ylb in {0/0,1/1}{\draw(0,-\ky*\kystep-\kystep/2)node[left]{$\ylb$};}
\foreach \kx/\xlb in {0/{},1/{},2/{1},3/{}}{\draw(\kx*\kxstep+\kxstep/2,-\kystep/2)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{},1/{},2/{1},3/{}}{\draw(\kx*\kxstep+\kxstep/2,-1.5*\kystep)node[]{$\xlb$};}
\draw[gray,dashed] ($(2*\kxstep,0)+(\kmv,-\kmv)$) rectangle ($(3*\kxstep,-2*\kystep)+(-\kmv,\kmv)$);
\end{tikzpicture}\quad\quad 
\(T_2=Q_1Q_0\)
\caption*{} 					%gives space between subfigures
\end{subfigure}
\begin{subfigure}{1\textwidth}
\centering
\begin{tikzpicture}
\pgfmathsetmacro{\kxstep}{1}
\pgfmathsetmacro{\kystep}{1}
\pgfmathsetmacro{\kpin}{0.75}
\pgfmathsetmacro{\kmv}{0.15}
\draw[xstep=\kxstep,ystep=\kystep](0,0) grid (4*\kxstep,-2*\kystep);
\draw(0,0)--++(135:1.5*\kpin)node[pos=0.75,above right]{$Q_1Q_0$}node[pos=0.75,below left]{$Q_2$};
\foreach \kx/\xlb in {0/{00},1/{01},2/{11},3/{10}}{\draw(\kx*\kxstep+\kxstep/2,0)node[above]{$\xlb$};}
\foreach \ky/\ylb in {0/0,1/1}{\draw(0,-\ky*\kystep-\kystep/2)node[left]{$\ylb$};}
\foreach \kx/\xlb in {0/{},1/{1},2/{1},3/{}}{\draw(\kx*\kxstep+\kxstep/2,-\kystep/2)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{},1/{1},2/{1},3/{}}{\draw(\kx*\kxstep+\kxstep/2,-1.5*\kystep)node[]{$\xlb$};}
\draw[gray,dashed] ($(\kxstep,0)+(\kmv,-\kmv)$) rectangle ($(3*\kxstep,-2*\kystep)+(-\kmv,\kmv)$);
\end{tikzpicture}\quad\quad
\(T_1=Q_0\)
\caption*{} 					%gives space between subfigures
\end{subfigure}
\begin{subfigure}{1\textwidth}
\centering
\begin{tikzpicture}
\pgfmathsetmacro{\kxstep}{1}
\pgfmathsetmacro{\kystep}{1}
\pgfmathsetmacro{\kpin}{0.75}
\pgfmathsetmacro{\kmv}{0.15}
\draw[xstep=\kxstep,ystep=\kystep](0,0) grid (4*\kxstep,-2*\kystep);
\draw(0,0)--++(135:1.5*\kpin)node[pos=0.75,above right]{$Q_1Q_0$}node[pos=0.75,below left]{$Q_2$};
\foreach \kx/\xlb in {0/{00},1/{01},2/{11},3/{10}}{\draw(\kx*\kxstep+\kxstep/2,0)node[above]{$\xlb$};}
\foreach \ky/\ylb in {0/0,1/1}{\draw(0,-\ky*\kystep-\kystep/2)node[left]{$\ylb$};}
\foreach \kx/\xlb in {0/{1},1/{1},2/{1},3/{1}}{\draw(\kx*\kxstep+\kxstep/2,-\kystep/2)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{1},1/{1},2/{1},3/{1}}{\draw(\kx*\kxstep+\kxstep/2,-1.5*\kystep)node[]{$\xlb$};}
\draw[gray,dashed] ($(0,0)+(\kmv,-\kmv)$) rectangle ($(4*\kxstep,-2*\kystep)+(-\kmv,\kmv)$);
\end{tikzpicture}\quad\quad
\(T_0=1\)
\end{subfigure}
\end{figure}
%============================
%fig 8.4
\begin{figure}
\centering
\begin{subfigure}{0.45\textwidth}
\centering
\begin{tikzpicture}
\pgfmathsetmacro{\kxstep}{1}
\pgfmathsetmacro{\kystep}{1}
\pgfmathsetmacro{\kpin}{0.75}
\pgfmathsetmacro{\kmv}{0.15}
\draw[xstep=\kxstep,ystep=\kystep](0,0) grid (4*\kxstep,-4*\kystep);
\draw(0,0)--++(135:1.5*\kpin)node[pos=0.75,above right]{$Q_1Q_0$}node[pos=0.75,below left]{$Q_3Q_2$};
\foreach \kx/\xlb in {0/{00},1/{01},2/{11},3/{10}}{\draw(\kx*\kxstep+\kxstep/2,0)node[above]{$\xlb$};}
\foreach \ky/\ylb in {0/{00},1/{01},2/{11},3/{10}}{\draw(0,-\ky*\kystep-\kystep/2)node[left]{$\ylb$};}
\foreach \kx/\xlb in {0/{},1/{},2/{},3/{}}{\draw(\kx*\kxstep+\kxstep/2,-\kystep/2)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{},1/{},2/{1},3/{}}{\draw(\kx*\kxstep+\kxstep/2,-1.5*\kystep)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{},1/{1},2/{d},3/{d}}{\draw(\kx*\kxstep+\kxstep/2,-2.5*\kystep)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{d},1/{d},2/{d},3/{d}}{\draw(\kx*\kxstep+\kxstep/2,-3.5*\kystep)node[]{$\xlb$};}
\draw[gray,dashed] ($(2*\kxstep,-\kystep)+(\kmv,-\kmv)$) rectangle ($(3*\kxstep,-3*\kystep)+(-\kmv,\kmv)$);
\draw[gray,dashed] ($(1*\kxstep,-2*\kystep)+(\kmv,-\kmv)$) rectangle ($(3*\kxstep,-4*\kystep)+(-1.5*\kmv,\kmv)$);
\draw(2*\kxstep,-4.5*\kystep)node[below]{\(T_3=Q_3Q_0+Q_2Q_1Q_0\)};
\end{tikzpicture}
\caption*{} 					%gives space between subfigures
\end{subfigure}\hfill
\begin{subfigure}{0.45\textwidth}
\centering
\begin{tikzpicture}
\pgfmathsetmacro{\kxstep}{1}
\pgfmathsetmacro{\kystep}{1}
\pgfmathsetmacro{\kpin}{0.75}
\pgfmathsetmacro{\kmv}{0.15}
\draw[xstep=\kxstep,ystep=\kystep](0,0) grid (4*\kxstep,-4*\kystep);
\draw(0,0)--++(135:1.5*\kpin)node[pos=0.75,above right]{$Q_1Q_0$}node[pos=0.75,below left]{$Q_3Q_2$};
\foreach \kx/\xlb in {0/{00},1/{01},2/{11},3/{10}}{\draw(\kx*\kxstep+\kxstep/2,0)node[above]{$\xlb$};}
\foreach \ky/\ylb in {0/{00},1/{01},2/{11},3/{10}}{\draw(0,-\ky*\kystep-\kystep/2)node[left]{$\ylb$};}
\foreach \kx/\xlb in {0/{},1/{},2/{1},3/{}}{\draw(\kx*\kxstep+\kxstep/2,-\kystep/2)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{},1/{},2/{1},3/{}}{\draw(\kx*\kxstep+\kxstep/2,-1.5*\kystep)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{},1/{},2/{d},3/{d}}{\draw(\kx*\kxstep+\kxstep/2,-2.5*\kystep)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{d},1/{d},2/{d},3/{d}}{\draw(\kx*\kxstep+\kxstep/2,-3.5*\kystep)node[]{$\xlb$};}
\draw[gray,dashed] ($(2*\kxstep,-0*\kystep)+(\kmv,-\kmv)$) rectangle ($(3*\kxstep,-4*\kystep)+(-\kmv,\kmv)$);
%\draw[gray,dashed] ($(1*\kxstep,-2*\kystep)+(\kmv,-\kmv)$) rectangle ($(3*\kxstep,-4*\kystep)+(-1.5*\kmv,\kmv)$);
\draw(2*\kxstep,-4.5*\kystep)node[below]{\(T_2=Q_1Q_0\)};
\end{tikzpicture}
\caption*{} 					%gives space between subfigures
\end{subfigure}
\begin{subfigure}{0.45\textwidth}
\centering
\begin{tikzpicture}
\pgfmathsetmacro{\kxstep}{1}
\pgfmathsetmacro{\kystep}{1}
\pgfmathsetmacro{\kpin}{0.75}
\pgfmathsetmacro{\kmv}{0.15}
\draw[xstep=\kxstep,ystep=\kystep](0,0) grid (4*\kxstep,-4*\kystep);
\draw(0,0)--++(135:1.5*\kpin)node[pos=0.75,above right]{$Q_1Q_0$}node[pos=0.75,below left]{$Q_3Q_2$};
\foreach \kx/\xlb in {0/{00},1/{01},2/{11},3/{10}}{\draw(\kx*\kxstep+\kxstep/2,0)node[above]{$\xlb$};}
\foreach \ky/\ylb in {0/{00},1/{01},2/{11},3/{10}}{\draw(0,-\ky*\kystep-\kystep/2)node[left]{$\ylb$};}
\foreach \kx/\xlb in {0/{},1/{1},2/{1},3/{}}{\draw(\kx*\kxstep+\kxstep/2,-\kystep/2)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{},1/{1},2/{1},3/{}}{\draw(\kx*\kxstep+\kxstep/2,-1.5*\kystep)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{},1/{},2/{d},3/{d}}{\draw(\kx*\kxstep+\kxstep/2,-2.5*\kystep)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{d},1/{d},2/{d},3/{d}}{\draw(\kx*\kxstep+\kxstep/2,-3.5*\kystep)node[]{$\xlb$};}
\draw[gray,dashed] ($(1*\kxstep,-0*\kystep)+(\kmv,-\kmv)$) rectangle ($(3*\kxstep,-2*\kystep)+(-\kmv,\kmv)$);
%\draw[gray,dashed] ($(1*\kxstep,-2*\kystep)+(\kmv,-\kmv)$) rectangle ($(3*\kxstep,-4*\kystep)+(-1.5*\kmv,\kmv)$);
\draw(2*\kxstep,-4.5*\kystep)node[below]{\(T_1=\overline{Q}_3Q_0\)};
\end{tikzpicture}
\caption*{} 					%gives space between subfigures
\end{subfigure}\hfill
\begin{subfigure}{0.45\textwidth}
\centering
\begin{tikzpicture}
\pgfmathsetmacro{\kxstep}{1}
\pgfmathsetmacro{\kystep}{1}
\pgfmathsetmacro{\kpin}{0.75}
\pgfmathsetmacro{\kmv}{0.15}
\draw[xstep=\kxstep,ystep=\kystep](0,0) grid (4*\kxstep,-4*\kystep);
\draw(0,0)--++(135:1.5*\kpin)node[pos=0.75,above right]{$Q_1Q_0$}node[pos=0.75,below left]{$Q_3Q_2$};
\foreach \kx/\xlb in {0/{00},1/{01},2/{11},3/{10}}{\draw(\kx*\kxstep+\kxstep/2,0)node[above]{$\xlb$};}
\foreach \ky/\ylb in {0/{00},1/{01},2/{11},3/{10}}{\draw(0,-\ky*\kystep-\kystep/2)node[left]{$\ylb$};}
\foreach \kx/\xlb in {0/{1},1/{1},2/{1},3/{1}}{\draw(\kx*\kxstep+\kxstep/2,-\kystep/2)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{1},1/{1},2/{1},3/{1}}{\draw(\kx*\kxstep+\kxstep/2,-1.5*\kystep)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{1},1/{1},2/{d},3/{d}}{\draw(\kx*\kxstep+\kxstep/2,-2.5*\kystep)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{d},1/{d},2/{d},3/{d}}{\draw(\kx*\kxstep+\kxstep/2,-3.5*\kystep)node[]{$\xlb$};}
\draw[gray,dashed] ($(0*\kxstep,-0*\kystep)+(\kmv,-\kmv)$) rectangle ($(4*\kxstep,-4*\kystep)+(-\kmv,\kmv)$);
%\draw[gray,dashed] ($(1*\kxstep,-2*\kystep)+(\kmv,-\kmv)$) rectangle ($(3*\kxstep,-4*\kystep)+(-1.5*\kmv,\kmv)$);
\draw(2*\kxstep,-4.5*\kystep)node[below]{\(T_0=1\)};
\end{tikzpicture}
\caption*{} 					%gives space between subfigures
\end{subfigure}
\begin{subfigure}{0.45\textwidth}
\centering
\begin{tikzpicture}
\pgfmathsetmacro{\kxstep}{1}
\pgfmathsetmacro{\kystep}{1}
\pgfmathsetmacro{\kpin}{0.75}
\pgfmathsetmacro{\kmv}{0.15}
\draw[xstep=\kxstep,ystep=\kystep](0,0) grid (4*\kxstep,-4*\kystep);
\draw(0,0)--++(135:1.5*\kpin)node[pos=0.75,above right]{$Q_1Q_0$}node[pos=0.75,below left]{$Q_3Q_2$};
\foreach \kx/\xlb in {0/{00},1/{01},2/{11},3/{10}}{\draw(\kx*\kxstep+\kxstep/2,0)node[above]{$\xlb$};}
\foreach \ky/\ylb in {0/{00},1/{01},2/{11},3/{10}}{\draw(0,-\ky*\kystep-\kystep/2)node[left]{$\ylb$};}
\foreach \kx/\xlb in {0/{},1/{},2/{},3/{}}{\draw(\kx*\kxstep+\kxstep/2,-\kystep/2)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{},1/{},2/{},3/{}}{\draw(\kx*\kxstep+\kxstep/2,-1.5*\kystep)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{},1/{1},2/{d},3/{d}}{\draw(\kx*\kxstep+\kxstep/2,-2.5*\kystep)node[]{$\xlb$};}
\foreach \kx/\xlb in {0/{d},1/{d},2/{d},3/{d}}{\draw(\kx*\kxstep+\kxstep/2,-3.5*\kystep)node[]{$\xlb$};}
\draw[gray,dashed] ($(1*\kxstep,-2*\kystep)+(\kmv,-\kmv)$) rectangle ($(3*\kxstep,-4*\kystep)+(-\kmv,\kmv)$);
%\draw[gray,dashed] ($(1*\kxstep,-2*\kystep)+(\kmv,-\kmv)$) rectangle ($(3*\kxstep,-4*\kystep)+(-1.5*\kmv,\kmv)$);
\draw(2*\kxstep,-4.5*\kystep)node[below]{\(y=Q_3Q_0\)};
\end{tikzpicture}
\caption*{} 					%gives space between subfigures
\end{subfigure}
\end{figure}
%============================
%8.5 
\begin{figure}
\centering
\begin{tikzpicture}
\pgfmathsetmacro{\ksepX}{2.5}
\pgfmathsetmacro{\ksepY}{1.5}
\pgfmathsetmacro{\kpinA}{0.5}
\pgfmathsetmacro{\kpinB}{0.4}
\kuTFFd[u0]{0}{0}
\kuTFFd[u1]{-1*\ksepX}{0}
\kuTFFd[u2]{-2*\ksepX}{0}
\kuTFFd[u3]{-3*\ksepX}{0}
\draw(u0p6)node[above]{$Q_0$};
\draw(u1p6)node[above]{$Q_1$};
\draw(u2p6)node[above]{$Q_2$};
\draw(u3p6)node[above]{$Q_3$};
\draw(u0p1)--++(0,-2*\kpinA)node[and port,scale=1,number inputs=2,rotate=90,anchor=out](u4){};
\draw(u1p1)--++(0,-2*\kpinA)node[and port,scale=1,number inputs=2,rotate=90,anchor=out](u5){};
\draw(u2p1)--++(0,-2*\kpinA)node[and port,scale=1,number inputs=2,rotate=90,anchor=out](u6){};
\draw(u3p1)--++(0,-2*\kpinA)node[and port,scale=1,number inputs=2,rotate=90,anchor=out](u7){};
\draw(u7.in 1)node[or port,scale=1,number inputs=2,rotate=90,anchor=out](u8){};
\draw(u8.in 1)--++(-\kpinA,0)node[and port,scale=1,rotate=90,anchor=out,number inputs=2](u9){};
\draw(u8.in 2)--++(\kpinA,0)node[and port,scale=1,rotate=90,anchor=out,number inputs=3](u10){};
\draw(u9.in 1)node[below]{$Q_3$};
\draw(u9.in 2)node[below]{$Q_0$};
\draw(u10.in 1)node[below,xshift=-0.5ex]{$Q_2$};
\draw(u10.in 2)node[below]{$Q_1$};
\draw(u10.in 3)node[below,xshift=0.5ex]{$Q_0$};
\draw(u6.in 1)node[and port,scale=1,number inputs=2,rotate=90,anchor=out](u11){};
\draw(u11.in 1)|-(u11.in 1 |- u10.in 2)node[below]{$Q_1$};
\draw(u11.in 2)|-(u11.in 2 |- u10.in 2)node[below]{$Q_0$};
\draw(u5.in 1)node[and port,scale=1,number inputs=2,rotate=90,anchor=out](u12){};
\draw(u12.in 1)|-(u12.in 1 |- u10.in 2)node[below]{$\overline{Q}_3$};
\draw(u12.in 2)|-(u12.in 2 |- u10.in 2)node[below]{$Q_0$};
\draw(u4.in 1)|-(u4.in 1 |- u10.in 2)node[below]{$1$};
\draw($(u3p6)+(-1*\ksepX,0)$)node[and port,scale=1,number inputs=2,rotate=90,anchor=out](u13){};
\draw(u13.out)node[above]{$y$};
\draw(u13.in 1)--(u13.in 1 |- u9.in 1)node[below]{$Q_3$};
\draw(u13.in 2)--(u13.in 2 |- u9.in 1)node[below]{$Q_0$};
\draw(u7.in 2)--(u4.in 2)coordinate(kcnt);
\kindown[j1]{kcnt};
\draw(j1south)node[left,rotate=90]{گِن};
\draw(u3p2)--(u0p2)--++(1*\kpinA,0)coordinate(kclk)--(kclk |- kcnt)coordinate(kclkin);
\kindown[j2]{kclkin};
\draw(j2south)node[left,rotate=90]{ساعت};
\draw(u0pd)--++(0,-2.5*\kpinA)coordinate(krst)-|(u3pd);
\kindown[j3]{krst};
\draw(j3east)node[below,rotate=90]{$\overline{\text{\RL{زبردستی پست}}}$};
\end{tikzpicture}
\end{figure}

%=======================

