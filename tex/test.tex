\begin{figure}
\centering
\begin{tikzpicture}
\pgfmathsetmacro{\ksepXa}{2.75}
\pgfmathsetmacro{\ksepXb}{0.20}
\pgfmathsetmacro{\ksepYa}{3.5}
\pgfmathsetmacro{\ksepYb}{1.25}
\pgfmathsetmacro{\ksepYc}{1}%{0.75}
\pgfmathsetmacro{\ksepYd}{1.1}%{0.85}
\pgfmathsetmacro{\ksepYe}{0.65}
\pgfmathsetmacro{\kpinA}{0.5}
\pgfmathsetmacro{\kpinB}{0.4}
\pgfmathsetmacro{\kpinC}{2.00}
\kuDFF[u0]{0}{0}
\kuDFF[u1]{-1*\ksepXa}{0}
\kuDFF[u2]{-2*\ksepXa}{0}
\kuDFF[u3]{-3*\ksepXa}{0}
\kupinAnchors
\kuBuffer[u17]{\pfx}{\kpinB+\pfy}
\draw(u17pout)--++(0,\kpinA/3)node[above]{$D_0$};
\kuBuffer[u18]{-1*\ksepXa+\pfx}{\kpinB+\pfy}
\draw(u18pout)--++(0,\kpinA/3)node[above]{$D_1$};
\kuBuffer[u19]{-2*\ksepXa+\pfx}{\kpinB+\pfy}
\draw(u19pout)--++(0,\kpinA/3)node[above]{$D_2$};
\kuBuffer[u20]{-3*\ksepXa+\pfx}{\kpinB+\pfy}
\draw(u20pout)--++(0,\kpinA/3)node[above]{$D_3$};
\draw(u17pbu)--++(-\kpin,0)--++(0,\ksepYe)coordinate(tt);
\draw(u17pnu)node[ocirc]{};
\draw(u18pbu)--++(-\kpin,0)--++(0,\ksepYe);
\draw(u18pnu)node[ocirc]{};
\draw(u19pbu)--++(-\kpin,0)--++(0,\ksepYe);
\draw(u19pnu)node[ocirc]{};
\draw(u20pbu)--++(-\kpin,0)--++(0,\ksepYe)coordinate(ttt);
\draw(u20pnu)node[ocirc]{};
\draw(u0p6)--++(0,\kpinB);
\draw(u1p6)--++(0,\kpinB);
\draw(u2p6)--++(0,\kpinB);
\draw(u3p6)--++(0,\kpinB);
\draw(u0p6)node[above left]{$Q_0$}++(0,0.25)coordinate(ka);
\draw(u1p6)node[above left]{$Q_1$};
\draw(u2p6)node[above left]{$Q_2$};
\draw(u3p6)node[above right]{$Q_3$}++(0,0.25)coordinate(kb);
\koutright[j0]{ka}
\draw(j0east)node[right]{\text{\RL{دائیں خروج}}};
\koutleft[j1]{kb}
\draw(j1west)node[left]{\text{\RL{بائیں خروج}}};
\kupinAnchors									%gives values of pax etc
\kmuxD[u5]{-0*\ksepXa-\kul-2*\kpsep+\pax}{-\ksepYa}
\kmuxD[u6]{-1*\ksepXa-\kul-2*\kpsep+\pax}{-\ksepYa}
\kmuxD[u7]{-2*\ksepXa-\kul-2*\kpsep+\pax}{-\ksepYa}
\kmuxD[u8]{-3*\ksepXa-\kul-2*\kpsep+\pax}{-\ksepYa}
\draw(u0pbd)--++(\kpin,0)--++(0,-\ksepYb)coordinate(ll);
\draw(u0pnd)node[ocirc]{};
\draw(u1pbd)--++(\kpin,0)--++(0,-\ksepYb);
\draw(u1pnd)node[ocirc]{};
\draw(u2pbd)--++(\kpin,0)--++(0,-\ksepYb);
\draw(u2pnd)node[ocirc]{};
\draw(u3pbd)--++(\kpin,0)--++(0,-\ksepYb)coordinate(rr);
\draw(u3pnd)node[ocirc]{};
\draw(rr)++(-\ksepXa-1,0)coordinate(lft);
\draw(rr)--(ll)--++(0,-0.5)node[below]{$\overline{\text{بیٹھ}}$};
\draw(u0p2)--(u3p2)--++(-1,0)node[left]{$C$};
\draw(tt)--(ttt)--++(-0.75,0)node[above]{$\overline{\text{\RL{متوازی خارج}}}$};
\draw(u0p1)--(u5dp2);
\draw(u1p1)--(u6dp2);
\draw(u2p1)--(u7dp2);
\draw(u3p1)--(u8dp2);
\draw(u5ap2)--++(0,\ksepYc)coordinate(aa);
\draw(u5ap1)--++(-\ksepXb,0)--++(0,\ksepYd)coordinate(bb);
\draw(u6ap2)--++(0,\ksepYc);
\draw(u6ap1)--++(-\ksepXb,0)--++(0,\ksepYd);
\draw(u7ap2)--++(0,\ksepYc);
\draw(u7ap1)--++(-\ksepXb,0)--++(0,\ksepYd);
\draw(u8ap2)--++(0,\ksepYc)coordinate(aaa);
\draw(u8ap1)--++(-\ksepXb,0)--++(0,\ksepYd)coordinate(bbb);
\draw(aa)--(aaa)--++(0,0.25)coordinate(abab)node[above, xshift=0.75ex]{$a_1$};
\draw(bb)--(bbb)--(bbb |-abab)node[above,xshift=-0.75ex]{$a_0$};
\draw(u5bp0)node[below]{$y$};
\draw(u5bp1)node[below]{$Q_1$};
\draw(u5bp2)node[below]{$z_0$};
\draw(u5bp3)node[below]{$Q_0$};
\draw(u6bp0)node[below]{$Q_0$};
\draw(u6bp1)node[below]{$Q_2$};
\draw(u6bp2)node[below]{$z_1$};
\draw(u6bp3)node[below]{$Q_1$};
\draw(u7bp0)node[below]{$Q_1$};
\draw(u7bp1)node[below]{$Q_3$};
\draw(u7bp2)node[below]{$z_2$};
\draw(u7bp3)node[below]{$Q_2$};
\draw(u8bp0)node[below]{$Q_2$};
\draw(u8bp1)node[below]{$x$};
\draw(u8bp2)node[below]{$z_3$};
\draw(u8bp3)node[below]{$Q_3$};
\end{tikzpicture}
\caption{چار بِٹ ، عالمگیر  انتقال دفتر}
\label{شکل_دفتر_عالمگیر_انتقال_دفتر}
\end{figure}
